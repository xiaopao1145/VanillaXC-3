name: ğŸ§© VanillaXC3 CI/CD æ„å»º (Build)

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]
  # Allow manual trigger
  # å…è®¸æ‰‹åŠ¨è§¦å‘
  workflow_dispatch:

jobs:
  build:
    # Use the latest Ubuntu runner environment
    # ä½¿ç”¨æœ€æ–°çš„ Ubuntu è¿è¡Œç¯å¢ƒ
    runs-on: ubuntu-latest
    permissions:
      contents: read

    # Define environment variables for consistency
    # å®šä¹‰æ„å»ºç›¸å…³çš„ç¯å¢ƒå˜æ•°ï¼Œä¾¿äºç»Ÿä¸€ç®¡ç†
    env:
      JAVA_VERSION: '21'
      # Ensure shadowJar task is run to package all dependencies
      # ç¡®ä¿è¿è¡Œ shadowJar ä»»åŠ¡æ¥æ‰“åŒ…æ‰€æœ‰ä¾èµ–
      GRADLE_BUILD_TASK: 'shadowJar'

    steps:
      - name: â¬‡ï¸ Checkout Repository | æ£€å‡ºä»£ç ä»“åº“
        # ä½¿ç”¨å®Œæ•´ SHA å€¼æ›¿æ¢ @v4
        uses: actions/checkout@b4ffde65f46336ab88eb5d329bb20d111d8c01af

      - name: â˜• Setup Java JDK ${{ env.JAVA_VERSION }} Environment | é…ç½® Java JDK ${{ env.JAVA_VERSION }} ç¯å¢ƒ
        # ä½¿ç”¨å®Œæ•´ SHA å€¼æ›¿æ¢ @v4
        uses: actions/setup-java@00688d088924f7b491950a417088b69ff2467d3d
        with:
          java-version: ${{ env.JAVA_VERSION }}
          distribution: 'temurin'
          # Cache Gradle dependencies for faster builds
          # ç¼“å­˜ Gradle ä¾èµ–ï¼Œæé«˜æ„å»ºé€Ÿåº¦
          cache: 'gradle'

      - name: ğŸ” Grant execute permission for gradlew | æˆäºˆ gradlew è„šæœ¬æ‰§è¡Œæƒé™
        # Ensure gradlew script has execute permission
        # ç¡®ä¿ gradlew è„šæœ¬æœ‰æ‰§è¡Œæƒé™
        run: chmod +x gradlew

      - name: âš™ï¸ Execute Gradle Build and Shading (${{ env.GRADLE_BUILD_TASK }}) | æ‰§è¡Œ Gradle æ„å»ºä¸ä¾èµ–æ‰“åŒ…
        # Run the shadowJar task to generate the JAR with dependencies
        # è¿è¡Œ shadowJar ä»»åŠ¡ç”ŸæˆåŒ…å«ä¾èµ–çš„ JAR
        run: ./gradlew ${{ env.GRADLE_BUILD_TASK }}

      # -----------------------------------------------------------
      # [Upload Artifacts] | ã€ä¸Šä¼ å·¥ä»¶ã€‘
      # -----------------------------------------------------------
      - name: ğŸ“¦ Upload Build Artifact (Plugin JAR) | ä¸Šä¼ æ„å»ºå·¥ä»¶ (æ’ä»¶ JAR)
        # Only run this step if the previous build step was successful
        # åªæœ‰å½“å‰é¢çš„æ„å»ºæ­¥éª¤æˆåŠŸåæ‰æ‰§è¡Œä¸Šä¼ 
        if: success()
        # ä½¿ç”¨å®Œæ•´ SHA å€¼æ›¿æ¢ @v4
        uses: actions/upload-artifact@56986c7521e909a32c286595566c5d109f30b910
        with:
          # Artifact name
          # å·¥ä»¶åç§°
          name: VanillaXC3-Artifact

          # Specify the path for all JAR files inside build/libs/
          # æŒ‡å®šä¸Šä¼  build/libs/ ç›®å½•ä¸‹çš„æ‰€æœ‰ JAR æ–‡ä»¶
          path: build/libs/*.jar

          # Set retention days to the maximum allowed (90 days for most users)
          # å°†å·¥ä»¶ä¿ç•™æ—¥æœŸè®¾ç½®ä¸ºæœ€å¤§å€¼ 90 å¤©
          retention-days: 90