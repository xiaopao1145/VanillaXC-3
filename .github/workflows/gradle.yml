name: ğŸ§© VanillaXC3 CI/CD æ„å»º

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]
  # å…è®¸æ‰‹åŠ¨è§¦å‘
  workflow_dispatch:

jobs:
  build:
    # ä½¿ç”¨æœ€æ–°çš„ Ubuntu è¿è¡Œç¯å¢ƒ
    runs-on: ubuntu-latest
    permissions:
      contents: read

    # å®šä¹‰æ„å»ºç›¸å…³çš„ç¯å¢ƒå˜æ•°
    env:
      JAVA_VERSION: '21'
      # ä½¿ç”¨ shadowJar ä»»åŠ¡æ¥æ‰“åŒ…æ‰€æœ‰ä¾èµ–
      GRADLE_BUILD_TASK: 'shadowJar'

    steps:
      - name: â¬‡ï¸ æ£€å‡ºä»£ç ä»“åº“
        uses: actions/checkout@v4

      - name: â˜• é…ç½® Java JDK ${{ env.JAVA_VERSION }} ç¯å¢ƒ
        uses: actions/setup-java@v4
        with:
          java-version: ${{ env.JAVA_VERSION }}
          distribution: 'temurin'
          # ç¼“å­˜ Gradle ä¾èµ–ï¼Œæé«˜æ„å»ºé€Ÿåº¦
          cache: 'gradle'

      - name: ğŸ” æˆäºˆ gradlew è„šæœ¬æ‰§è¡Œæƒé™
        # ç¡®ä¿ gradlew è„šæœ¬æœ‰æ‰§è¡Œæƒé™
        run: chmod +x gradlew

      - name: âš™ï¸ æ‰§è¡Œ Gradle æ„å»ºä¸ä¾èµ–æ‰“åŒ… (${{ env.GRADLE_BUILD_TASK }})
        # è¿è¡Œ shadowJar ä»»åŠ¡ç”ŸæˆåŒ…å«ä¾èµ–çš„ JAR
        run: ./gradlew ${{ env.GRADLE_BUILD_TASK }}

      # -----------------------------------------------------------
      # ã€ä¸Šä¼ å·¥ä»¶ã€‘
      # -----------------------------------------------------------
      - name: ğŸ“¦ ä¸Šä¼ æ„å»ºå·¥ä»¶ (Plugin JAR)
        # åªæœ‰å½“å‰é¢çš„æ„å»ºæ­¥éª¤æˆåŠŸåæ‰æ‰§è¡Œä¸Šä¼ 
        if: success()
        uses: actions/upload-artifact@v4
        with:
          # å·¥ä»¶åç§°
          name: VanillaXC3-Artifact

          # æŒ‡å®šä¸Šä¼  build/libs/ ç›®å½•ä¸‹çš„æ‰€æœ‰ JAR æ–‡ä»¶
          path: build/libs/*.jar

          # è®¾ç½®å·¥ä»¶çš„ä¿ç•™æ—¶é—´ä¸º 7 å¤©
          retention-days: 90