name: Java CI with Gradle (Plugin Build)

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]
  # å…è®¸æ‰‹åŠ¨è§¦å‘
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    permissions:
      contents: read
    
    # å®šä¹‰ç¯å¢ƒå˜æ•°ï¼Œä¾¿äºç»Ÿä¸€ç®¡ç†
    env:
      JAVA_VERSION: '21'
      GRADLE_BUILD_TASK: 'shadowJar' # ç¡®ä¿è¿è¡Œ shadowJar ä»»åŠ¡æ¥æ‰“åŒ…æ‰€æœ‰ä¾èµ–

    steps:
    - name: â¬‡ï¸ Checkout Repository
      # æ£€å‡ºä»£ç 
      uses: actions/checkout@v4
      
    - name: â˜• Set up JDK ${{ env.JAVA_VERSION }}
      # è®¾ç½® Java 21 ç¯å¢ƒ (ä¸ä½ çš„é¡¹ç›®åŒ¹é…)
      uses: actions/setup-java@v4
      with:
        java-version: ${{ env.JAVA_VERSION }}
        distribution: 'temurin'
        cache: 'gradle' # ç¼“å­˜ Gradle ä¾èµ–ï¼Œæé«˜é€Ÿåº¦

    - name: âš™ï¸ Grant execute permission for gradlew
      # ç¡®ä¿ gradlew è„šæœ¬æœ‰æ‰§è¡Œæƒé™
      run: chmod +x gradlew
      
    - name: ğŸ”¨ Build and Shade Plugin JAR
      # è¿è¡Œ shadowJar ä»»åŠ¡ç”ŸæˆåŒ…å«ä¾èµ–çš„ JAR
      run: ./gradlew ${{ env.GRADLE_BUILD_TASK }}

    # -----------------------------------------------------------
    # ã€æ ¸å¿ƒæ­¥éª¤ã€‘ä¸Šä¼ æ„å»ºå·¥ä»¶ (Artifacts)
    # -----------------------------------------------------------
    - name: â¬†ï¸ Upload Plugin Artifact
      uses: actions/upload-artifact@v4
      with:
        # å·¥ä»¶åç§°
        name: VanillaXC3-Plugin-Artifact
        
        # æŒ‡å®šä¸Šä¼  build/libs/ ç›®å½•ä¸‹çš„æ‰€æœ‰ JAR æ–‡ä»¶
        path: build/libs/*.jar
        
        # è®¾ç½®å·¥ä»¶çš„ä¿ç•™æ—¶é—´ (å¯é€‰)
        retention-days: 7
